$SourcePath="@CMAKE_CURRENT_SOURCE_DIR@"
$TargetPath="@CMAKE_CURRENT_BINARY_DIR@"

$InstallerPath="$TargetPath/installer"
$InstallerFiles="$InstallerPath/build"

# Create output directory
New-Item -Force -Path $InstallerFiles -ItemType "directory"

# Copy data resources
Copy-Item -Force $SourcePath/dll/airspy/x86_64/bin/*.dll $InstallerFiles
Copy-Item -Force $SourcePath/dll/hydrasdr/x86_64/bin/*.dll $InstallerFiles
Copy-Item -Force $SourcePath/dll/openssl/x86_64/bin/*.dll $InstallerFiles
Copy-Item -Force $SourcePath/dll/rtlsdr/x86_64/bin/*.dll $InstallerFiles
Copy-Item -Force $SourcePath/dll/usb/x86_64/bin/*.dll $InstallerFiles
Copy-Item -Force $TargetPath/src/nfc-app/app-qt/nfc-lab.exe $InstallerFiles

# Create QT deployment from executable
windeployqt --verbose 1 --release --force --compiler-runtime --no-translations --no-system-d3d-compiler --no-opengl-sw $InstallerFiles/nfc-lab.exe

# Create QT installer
makensis $InstallerPath/script.nsi
